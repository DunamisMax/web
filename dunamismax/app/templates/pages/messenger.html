{% extends "base.html" %}

{% block title %}Messenger{% endblock %}

{% block content %}
<div class="messenger-page fade-in">
    <h1>Live Messenger</h1>
    <p class="messenger-intro">Connect with others in real-time using WebSocket technology.</p>

    <div class="messenger-container card">
        <div class="message-list" id="message-list" hx-sse="connect:/api/messages">
            <!-- Messages will be inserted here -->
            <div class="message">
                <div class="message-header">
                    <span class="username">System</span>
                    <span class="timestamp">now</span>
                </div>
                <div class="message-content">
                    Welcome to the messenger! Messages will appear here.
                </div>
            </div>
        </div>

        <div class="message-input">
            <form hx-post="/api/messages" hx-target="#message-list" hx-swap="beforeend">
                <div class="input-group">
                    <input 
                        type="text" 
                        name="message" 
                        placeholder="Type your message..." 
                        autocomplete="off"
                        required
                    >
                    <button type="submit" class="btn">Send</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_head %}
<style>
    .messenger-page {
        max-width: 800px;
        margin: 0 auto;
    }

    .messenger-intro {
        color: var(--nord9);
        margin-bottom: 2rem;
    }

    .messenger-container {
        height: 70vh;
        display: flex;
        flex-direction: column;
    }

    .message-list {
        flex: 1;
        overflow-y: auto;
        padding: 1rem;
    }

    .message {
        margin-bottom: 1rem;
        padding: 1rem;
        background-color: var(--nord2);
        border-radius: 4px;
    }

    .message-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.5rem;
        font-size: 0.9rem;
    }

    .username {
        color: var(--nord8);
        font-weight: 500;
    }

    .timestamp {
        color: var(--nord9);
    }

    .input-group {
        display: flex;
        gap: 1rem;
        padding: 1rem;
        background-color: var(--nord1);
        border-top: 1px solid var(--nord3);
    }

    .input-group input {
        flex: 1;
    }
</style>
{% endblock %}

{% block scripts %}
<script>
    // Auto-scroll to bottom when new messages arrive
    const messageList = document.getElementById('message-list');
    const observer = new MutationObserver(() => {
        messageList.scrollTop = messageList.scrollHeight;
    });
    
    observer.observe(messageList, {
        childList: true,
        subtree: true
    });
</script>
{% endblock %}